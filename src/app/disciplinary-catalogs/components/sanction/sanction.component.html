<div nz-row>
  <div nz-col>
      <h1>Sanciones</h1>
  </div>
</div>

<!--Sanction searcher an create button-->
<div nz-row [nzGutter]="[20, 20]">

  <!-- Filters -->
  <div nz-col nzXs="24" nzSm="16" nzMd="12" nzLg="8">
    <label>Nombre: </label>
    <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
      <input type="text" nz-input placeholder="Buscar sanción" [(ngModel)]="searchValue"/>
    </nz-input-group>
    <ng-template #suffixIconButton>
      <button nz-button nzType="primary" nzSearch (click)="search()"><i nz-icon nzType="search"></i></button>
    </ng-template> 
  </div>

  <!-- Create button -->
  <div nz-col nzXs="24" nzSm="8" nzMd="12" nzLg="16" *ngIf="checkPermission(28)">
    <div class="btn-container" nz-row nzAlign="bottom" nzJustify="end">
      <a nz-button nzType="primary" (click)="create()">Crear sanción</a>
    </div>
  </div>
</div>

<!--Table-->
<div nz-row >
  <div nz-row>
    <div nz-col>
      <nz-spin nzTip="Cargando ..." [nzSpinning]="loading">
        <nz-table #filterTable
                  nzTableLayout="fixed"
                  nzSize="small"
                  [nzData]="listOfDisplayData"
                  [nzFrontPagination]="false"
                  [nzTotal]="pagination.totalItems"
                  [nzPageSize]="pagination.perPage"
                  [nzPageIndex]="pagination.page"
                  (nzQueryParams)="getSanctions($event)"
        >
          <thead>
            <tr>
              <th nzWidth="60px"></th>
              <th nzColumnKey="name" [nzSortFn]="true">Nombre</th>
              <th>Descripción</th>
              <th *ngIf="checkPermission(28)" [nzAlign]="'center'">Acción</th>
            </tr>
          </thead> 

          <!-- Table body -->
          <tbody>
            <ng-container *ngFor="let data of filterTable.data">
              <tr>
                <td [nzExpand]="expandSet.has(data.id)" (nzExpandChange)="onExpandChange(data.id, $event)"></td>
                <td>{{ data.name }}</td>
                <td nzEllipsis>{{ data.description }}</td>
  
                <!-- Actions -->
                <td *ngIf="checkPermission(28)" [nzAlign]="'center'">    
                  <span>
                    <a nz-tooltip  nzTooltipTitle="Actualizar">
                      <i nz-icon nzType="edit" nzTheme="outline" (click)="edit(data)"></i>
                    </a>
                    <nz-divider nzType="vertical"></nz-divider>
                    <a nz-tooltip nzTooltipTitle="Eliminar" (click)="showConfirm(data)">
                      <i nz-icon nzType="delete" nzTheme="outline"></i>
                    </a>
                  </span>
                </td>
                <!-- / Actions -->
              </tr>
  
              <!-- Expandable content -->
              <tr [nzExpand]="expandSet.has(data.id)">
                <strong>Descripción: </strong><span>{{ data.description }}</span>
              </tr>

            </ng-container>
          </tbody>
          <!-- / Table body -->
        </nz-table>
      </nz-spin>
    </div>
  </div> 
</div>

<!-- Create cycle modal -->
<nz-modal [(nzVisible)]="isVisible" nzTitle="Crear sanción" [nzContent]="modalContent" [nzFooter]="modalFooter">
    
  <!-- Modal content -->
  <ng-template #modalContent>
    <form nz-form [formGroup]="sanctionForm">

      <!-- Name -->
      <nz-form-item nzJustify="space-around">
        <nz-form-label nzRequired>Nombre</nz-form-label>
        <nz-form-control [nzSpan]="16" [nzErrorTip]="errorTpl">
          <div nz-row>
            <input nz-input formControlName="name" placeholder="Nombre de la sanción" />
            <ng-template #errorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">
                El nombre es requerido. <br>
              </ng-container>
              <ng-container *ngIf="control.hasError('pattern')">
                El nombre debe contener solo letras. <br>
              </ng-container>
              <ng-container *ngIf="control.hasError('maxlength')">
                El nombre debe contener máximo 128 caracteres.
              </ng-container>
            </ng-template>
          </div>
        </nz-form-control>

        <!-- Description -->
        <nz-form-label nzRequired>Descripción</nz-form-label>
        <nz-form-control [nzSpan]="16" [nzErrorTip]="errorTplTwo">
          <div nz-row>
          <textarea rows="6" nz-input formControlName="description" placeholder="Descripción de la sanción"></textarea>
            <ng-template #errorTplTwo let-control>
              <ng-container *ngIf="control.hasError('required')">
                La descripción es requerida. <br>
              </ng-container>
              <ng-container *ngIf="control.hasError('maxlength')">
                El nombre debe contener máximo 256 caracteres.
              </ng-container>
            </ng-template>
          </div>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-template>
  
  <!-- Modal footer -->
  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">Cancelar</button>
    <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="isConfirmLoading">Guardar</button>
  </ng-template>
</nz-modal>
