<h1>Cargar usuarios</h1>
<nz-spin nzTip="Cargando ..." [nzSpinning]="loading">
    <div nz-row nzJustify="space-around" [nzGutter]="[0, 10]">
        <div nz-col nzSm="24" nzMd="24" nzLg="6" nzXl="5" class="gutter-row">
            <nz-upload [nzFileList]="fileList" [nzBeforeUpload]="beforeUpload" [nzCustomRequest]="customReq" [nzRemove]="handleChange">
                <button nz-button>Seleccionar archivo</button>
            </nz-upload>
            <span class="error">{{uploadMsg}}</span>
        </div>

        <div nz-row nzJustify="space-around" [nzGutter]="[10, 10]">
            <div nz-col>
                <button nz-button nzType="primary" (click)="uploadCsv()">Iniciar carga de usuarios</button>
            </div>
            <div nz-col>
                <a nz-button nz-popconfirm nzTitle="¿Desea limpiar la pantalla?" (nzOnConfirm)="clearScreen()">Limpiar pantalla</a>
            </div>
        </div>
    </div>
    
    <ng-container *ngIf="_listOfColumns">
        <nz-table #editRowTable [nzData]="listOfData" nzTableLayout="fixed" nzSize="small">
            <thead>
                <tr>
                    <th *ngFor="let header of listOfColumns">{{ header }}</th>
                    <th [nzAlign]="'center'">Acción</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of editRowTable.data">
                    <!-- Non-editable row -->
                    <ng-container *ngIf="!editCache[data.id].edit; else editTemplate">
                        <td *ngFor="let header of _listOfColumns" [ngClass]="{ 'fieldError': !data[header]['isValid'] }"
                            nz-tooltip nzTooltipPlacement="topLeft" [nzTooltipTitle]="data[header]['message']">
                            {{ data[header]['value'] }}
                        </td>
                        <td [nzAlign]="'center'">
                            <a (click)="startEdit(data.id)">
                                <i nz-icon nzType="edit" nz-tooltip nzTooltipTitle="Editar" nzTheme="outline"></i>
                            </a>
                            <nz-divider nzType="vertical"></nz-divider>
                            <a nz-popconfirm nzTitle="¿Eliminar registro?" (nzOnConfirm)="removeRow(data.id)">
                                <i nz-icon nzType="delete" nz-tooltip nzTooltipTitle="Eliminar" nzTheme="outline"></i>
                            </a>
                            <ng-container *ngIf="data.inlineError">
                                <nz-divider nzType="vertical"></nz-divider>   
                                <i nz-icon nzType="warning" nzTheme="outline" [nzTheme]="'twotone'" [nzTwotoneColor]="'#ff4d4f'" nz-tooltip [nzTooltipTitle]="data.inlineError"></i>
                            </ng-container>
                        </td>
                    </ng-container>
    
                    <!-- Editable row -->
                    <ng-template #editTemplate>
                        <td *ngFor="let header of _listOfColumns" nz-tooltip  nzTooltipPlacement="topLeft" [nzTooltipTitle]="data[header]['message']">
                            <input type="text" nz-input [(ngModel)]="editCache[data.id].data[header]['value']">
                        </td>
                        <td [nzAlign]="'center'">
                            <a (click)="saveEdit(data.id)" class="save"> Guardar </a>
                            <nz-divider nzType="vertical"></nz-divider>
                            <a nz-popconfirm nzTitle="¿Cancelar edición?" (nzOnConfirm)="cancelEdit(data.id)">Cancelar</a>
                        </td>
                    </ng-template>
                </tr>
            </tbody>
        </nz-table>
    
        <div nz-row nzJustify="space-around">
            <button nz-button nzType="primary" (click)="createUsers()">Crear usuarios</button>
        </div>
    </ng-container>
</nz-spin>